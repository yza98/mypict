<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>My Pictionary</title>
    <link rel="icon"
        href="https://img.utdstc.com/icon/50d/8ba/50d8baa854e0e3d3be30e31340445d690976e13f6e46eb8976097db5551c4861:200"
        type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Estilos previos / fallback --- */

        @keyframes pulse-red {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0.5
            }
        }

        .timer-low {
            animation: pulse-red 0.5s infinite;
            color: #ef4444;
        }

        .token {
            width: calc(var(--tile-size) * 0.36);
            height: calc(var(--tile-size) * 0.36);
            border-radius: 9999px;
            border: 2px solid rgba(0, 0, 0, .6);
            box-shadow: 0 2px 6px rgba(0, 0, 0, .45);
            transition: transform .2s ease, box-shadow .2s ease;
        }

        .token.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, .5);
        }

        .tile-active {
            outline: 3px solid white;
            outline-offset: -3px;
            box-shadow: 0 0 12px rgba(255, 255, 255, .6);
        }

        #center-img-wrap {
            position: absolute !important;
            z-index: 0 !important;
            pointer-events: none !important;
        }

        #dice-btn {
            width: 96px !important;
            height: 96px !important;
            border-radius: 1rem !important;
            background: #fff !important;
            color: #0f172a !important;
            font-size: 28px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border: none !important;
        }

        #dice-face {
            font-size: 28px !important;
            line-height: 1 !important;
            display: inline-block !important;
        }

        /* Animaci√≥n del dado y cara final */
        @keyframes dice-roll-rotate {
            0% {
                transform: rotate(0deg) scale(1)
            }

            50% {
                transform: rotate(180deg) scale(1.03)
            }

            100% {
                transform: rotate(360deg) scale(1)
            }
        }

        .dice-rolling {
            animation: dice-roll-rotate 0.8s linear infinite;
        }

        .dice-face-final {
            font-size: 40px !important;
            transform: scale(1.25);
            transition: transform 200ms ease, font-size 200ms ease;
            display: inline-block;
            line-height: 1 !important;
        }

        /* --- Responsive: escalado del tablero, cambio de layout lateral en landscape/desktop --- */
        :root {
            --tile-size: 54px;
            --tile-gap: 8px;
            --board-scale: 1;
            --controls-width: 360px;
        }

        /* contenedor general de la pantalla de juego: header arriba, main abajo que cambia de layout */
        .game-screen {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* header (ya existente) */
        .game-header {
            flex: 0 0 auto;
        }

        /* main area: por defecto columna (board arriba, controles abajo) */
        .game-main {
            display: flex;
            flex-direction: column;
            flex: 1 1 auto;
            gap: 0;
            align-items: stretch;
        }

        /* wrapper del tablero y el tablero en s√≠ */
        /*#board-wrap {
            width: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
            box-sizing: border-box;
            flex: 1 1 auto;
        }*/

        #board-wrap {
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            box-sizing: border-box;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(11, var(--tile-size));
            grid-auto-rows: var(--tile-size);
            gap: var(--tile-gap);
            transform-origin: top center;
            transform: scale(var(--board-scale));
            will-change: transform;
            position: relative;
            z-index: 10;
            touch-action: manipulation;
            background: transparent;
        }

        [id^="tile-"] {
            width: var(--tile-size);
            height: var(--tile-size);
            min-width: 24px;
            min-height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            box-sizing: border-box;
            position: relative;
            overflow: visible;
        }

        /* controls panel (por defecto abajo) */
        #controls-panel {
            flex: 0 0 auto;
            padding: 1.25rem;
            box-sizing: border-box;
            background: transparent;
        }

        /* tokens relativos al tile-size */
        [id^="tks-"] {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 0.25rem;
            pointer-events: none;
            z-index: 30;
        }

        /* dado relativo */
        #dice-btn {
            width: calc(var(--tile-size)*1.6);
            height: calc(var(--tile-size)*1.6);
            font-size: calc(var(--tile-size)*0.45);
        }

        .dice-face-final {
            font-size: calc(var(--tile-size)*0.9) !important;
            transform: scale(1.15);
        }

        #center-img-wrap img {
            object-fit: contain;
            width: 100%;
            height: 100%;
        }

        @media (max-width:1100px) {
            :root {
                --tile-size: 48px;
                --tile-gap: 6px;
            }
        }

        @media (max-width:820px) {
            :root {
                --tile-size: 44px;
                --tile-gap: 6px;
            }
        }

        @media (max-width:480px) {
            :root {
                --tile-size: 40px;
                --tile-gap: 4px;
            }

            .p-6 {
                padding: 0.75rem !important;
            }

            .text-7xl {
                font-size: 3rem !important;
            }
        }

        @media (max-width:360px) {
            :root {
                --tile-size: 36px;
                --tile-gap: 4px;
            }

            #dice-btn {
                width: 68px !important;
                height: 68px !important;
                font-size: 20px !important;
            }

            .dice-face-final {
                font-size: calc(var(--tile-size)*1.3) !important;
                transform: scale(1.4);
            }

        }

        /* --- Cambio a layout lateral cuando hay ancho disponible o en landscape --- */
        /* Ajusta el min-width/orientation thresholds a tu gusto */
        @media (min-width: 900px),
        (orientation: landscape) and (min-width: 420px) {
            .game-main {
                flex-direction: row;
                align-items: stretch;
                gap: 0;
            }

            #board-wrap {
                flex: 1 1 auto;
                padding: 1.5rem;
            }

            #controls-panel {
                flex: 0 0 var(--controls-width);
                width: var(--controls-width);
                border-left: 1px solid rgba(148, 163, 184, 0.06);
                background: rgba(2, 6, 23, 0.35);
            }

            /* asegurar que panel de controles permita scroll si es necesario */
            #controls-panel {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* si se quiere, mantener panel con fondo est√°ndar */
            #controls-panel .panel-inner {
                background: #0f172a;
                border-radius: 1rem;
                padding: 0.75rem;
            }

            /* ajustar pill / header dentro del panel para ocupar espacio correctamente */
            .controls-top {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }

            .controls-bottom {
                margin-top: 0.75rem;
            }

            button {
                min-height: 44px;
                touch-action: manipulation;
            }

            button:active {
                transform: scale(0.96);
            }
        }

        .light-mode {
            background-color: #f8fafc !important;
            color: #0f172a !important;
        }

        .light-mode .bg-slate-800,
        .light-mode .bg-slate-900,
        .light-mode .bg-slate-950 {
            background-color: #e5e7eb !important;
            color: #0f172a !important;
        }

        .light-mode #target-word {
            color: #0f172a !important;
            /* slate-900 */
        }

        .light-mode #word-reveal-area {
            background-color: transparent;
        }

        @media (max-width: 360px) {
            #board {
                max-width: 100%;
            }
        }

        @media (min-width: 900px),
        (orientation: landscape) and (min-width: 600px) {
            #board-wrap {
                overflow-y: hidden !important;
                height: auto !important;
                align-items: center;
            }

            @media (max-width: 480px) {
                #current-team-name {
                    font-size: 1.25rem;
                    /* ~ text-lg */
                    line-height: 1.1;
                    max-width: 65vw;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                #status-badge {
                    font-size: 9px;
                    padding: 0.25rem 0.5rem;
                    white-space: nowrap;
                }

                #turn-label {
                    font-size: 9px;
                }
            }

        }

        @media (min-width: 640px) {
            #game-screen .game-header>div:last-child {
                flex-direction: row;
                align-items: center;
            }

            #game-screen .game-header>div:last-child>div:last-child {
                margin-left: 0.5rem;
            }
        }

        /* ===================== */
        /* üì∫ MODO TV (visual) */
        /* ===================== */

        .tv-mode {
            --tv-scale: 1.25;
        }

        .tv-mode .game-header {
            padding: 2rem 2.5rem;
        }

        .tv-mode #current-team-name {
            font-size: calc(2.5rem * var(--tv-scale)) !important;
            line-height: 1.1;
        }

        .tv-mode #status-badge {
            font-size: 1.1rem;
            padding: 0.6rem 1.2rem;
        }

        .tv-mode #turn-label {
            font-size: 1rem;
        }

        .tv-mode #target-word {
            font-size: calc(3.5rem * var(--tv-scale)) !important;
            letter-spacing: 0.06em;
        }

        .tv-mode button {
            font-size: 1rem;
            padding: 0.6rem 1.2rem;
        }

        @keyframes turn-flash {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }

            60% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 1;
            }
        }

        .turn-animate {
            animation: turn-flash 0.4s ease-out;
        }

        @keyframes header-pulse {
            0% {
                box-shadow: 0 0 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
            }

            100% {
                box-shadow: 0 0 0 rgba(255, 255, 255, 0);
            }
        }

        .header-turn-indicator {
            animation: header-pulse 0.6s ease-out;
        }

        #center-image {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
    </style>
</head>

<body class="bg-slate-900 text-white min-h-screen font-sans select-none"> <!-- PANTALLA INICIAL -->
    <div id="setup-screen" class="p-6 max-w-md mx-auto">
        <div class="flex justify-center mb-4"> <img
                src="https://upload.wikimedia.org/wikipedia/commons/3/34/Pictionary_game_logo.png" alt="Pictionary"
                class="h-20 object-contain" /> </div>
        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span class="w-2 h-6 bg-yellow-500 rounded-full"></span> Equipos
            </h2>
            <div id="teams-container" class="space-y-3">
                <input type="text" value="Equipo 1"
                    class="team-in w-full p-4 rounded-xl bg-slate-700 border-none focus:ring-2 ring-yellow-500 transition-all">
                <input type="text" value="Equipo 2"
                    class="team-in w-full p-4 rounded-xl bg-slate-700 border-none focus:ring-2 ring-yellow-500 transition-all">
            </div>

            <div class="flex items-center justify-between mt-4">
                <button onclick="addTeamField()" class="text-yellow-500 text-sm font-bold tracking-tighter">+ A√ëADIR
                    OTRO EQUIPO</button>
                <button onclick="initGame()"
                    class="ml-4 bg-yellow-500 hover:bg-yellow-400 text-slate-900 py-2 px-4 rounded-2xl font-black text-sm shadow-[0_4px_20px_rgba(234,179,8,0.4)] transition-transform active:scale-95">
                    ¬°COMENZAR!
                </button>
            </div>

            <div class="mt-6 bg-slate-900/30 p-4 rounded-lg text-xs text-slate-300">
                <h3 class="font-bold text-sm mb-2">Reglas b√°sicas</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Cada casilla tiene un color (AMARILLO/ AZUL/ NARANJA/ VERDE/ ROJO) que define la categor√≠a de la
                        palabra.</li>
                    <li>AMARILLO - Persona/Lugar/Animal (incluyendo nombres propios de personajes reales o de ficci√≥n).
                    </li>
                    <li>AZUL - Objeto (cosas que se pueden ver o tocar, partes, alimentos, etc.)</li>
                    <li>NARANJA - Acci√≥n (cosas que se pueden hacer)</li>
                    <li>VERDE - Dif√≠cil (palabras m√°s complejas)</li>
                    <li>ROJO - Todos Juegan (en esa casilla todos los equipos dibujan a la vez).</li>
                </ul>
                <h3 class="font-bold text-sm mb-2">Est√° permitido</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Dibujar cualquier cosa relacionada con la palabra o concepto.</li>
                    <li>Dividir la palabra en s√≠labas para facilitar el dibujo.</li>
                    <li>Guiarse por la fon√©tica de la palabra y no por su significado si es necesario.</li>
                </ul>
                <h3 class="font-bold text-sm mb-2">No est√° permitido</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Dibujar letras o n√∫meros.</li>
                    <li>Hablar al dibujante por parte de otros equipos.</li>
                    <li>Utilizar lenguaje de signos.</li>
                </ul>
            </div>
        </div>
    </div> <!-- PANTALLA DE JUEGO -->
    <div id="game-screen" class="game-screen hidden"> <!-- HEADER -->
        <div class="game-header p-4 bg-slate-800 border-b border-slate-700 flex justify-between items-end">
            <div>
                <p id="turn-label" class="text-[10px] font-bold text-slate-400 uppercase mb-1">Turno actual</p>
                <h2 id="current-team-name" class="text-2xl font-black leading-none">---</h2>
            </div>
            <div class="flex flex-col items-end gap-2">

                <!-- Fila superior: fase + reiniciar -->
                <div class="flex items-center gap-2">
                    <div id="status-badge"
                        class="bg-slate-900 px-3 py-1 rounded-lg text-[10px] font-bold border border-slate-600">
                        FASE: PREPARACI√ìN
                    </div>

                    <button id="reset-btn" onclick="confirmReset()"
                        class="px-3 py-1 rounded-lg bg-red-600 hover:bg-red-500 text-white text-xs font-bold shadow-sm">
                        REINICIAR
                    </button>
                </div>

                <!-- Fila inferior: sonido y tema -->
                <div class="flex items-center gap-2">
                    <button id="sound-toggle" aria-label="Activar o desactivar sonido" onclick="toggleSound()"
                        class="px-3 py-1 rounded-lg bg-slate-700 text-xs font-bold">
                        üîä
                    </button>
                    <button id="theme-toggle" aria-label="Cambiar modo claro u oscuro" onclick="toggleTheme()"
                        class="px-3 py-1 rounded-lg bg-slate-700 text-xs font-bold">
                        üåô
                    </button>
                    <!--
                    <button id="tv-toggle" aria-label="Activar modo TV" onclick="toggleTVMode()"
                        class="px-3 py-1 rounded-lg bg-slate-700 text-xs font-bold">
                        üì∫
                    </button>
                    -->

                </div>

            </div>

        </div>
        <!-- MAIN: board + controls (se reordena con media queries) -->
        <div class="game-main">
            <div id="board-wrap" class="flex-1 p-4 bg-slate-950 relative">
                <div id="board" class="mx-auto"></div>
                <div id="center-img-wrap" class="absolute z-0 pointer-events-none"></div>
            </div>

            <div id="controls-panel">
                <div
                    class="panel-inner bg-slate-800 p-6 rounded-t-[2.5rem] shadow-[0_-15px_40px_rgba(0,0,0,0.6)] border-t border-slate-700">
                    <div id="cat-display" class="flex flex-col items-center mb-6 controls-top">
                        <div id="cat-pill"
                            class="px-6 py-1.5 rounded-full text-[10px] font-black tracking-widest border-2 border-white/20 mb-2">
                            ---</div>
                        <p id="cat-instruction" class="text-slate-400 text-xs text-center px-4 italic font-medium">---
                        </p>
                    </div>

                    <div id="ui-move" class="hidden flex flex-col items-center">
                        <p class="text-green-400 font-black mb-4 uppercase tracking-tighter">¬°Acierto! Lanza el dado</p>
                        <button id="dice-btn" onclick="rollDice()" aria-label="Lanzar dado"
                            class="bg-white text-slate-900 rounded-3xl text-5xl shadow-2xl flex items-center justify-center active:scale-90 transition-all hover:rotate-12">
                            <span id="dice-face">üé≤</span>
                        </button>
                    </div>

                    <div id="ui-draw" class="space-y-4 controls-bottom">
                        <button id="btn-see-card" onclick="stepRevealWord()" aria-label="Ver palabra para dibujar"
                            class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black text-lg shadow-lg transition-all active:scale-95">VER
                            TARJETA</button>

                        <div id="word-reveal-area" class="hidden">
                            <div class="bg-slate-900 border-2 border-yellow-500/50 p-5 rounded-2xl text-center mb-4">
                                <span
                                    class="text-[10px] text-yellow-500 font-bold block mb-1 uppercase tracking-widest">Palabra
                                    a dibujar:</span>
                                <h3 id="target-word" class="text-3xl font-black text-white uppercase tracking-tight">---
                                </h3>
                            </div>

                            <div class="flex gap-3">
                                <button id="btn-change-word" onclick="changeWord()"
                                    aria-label="Cambiar palabra para dibujar"
                                    class="flex-1 bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-black text-sm">CAMBIAR
                                    (<span id="change-left">3</span>)
                                </button>
                                <button id="btn-start-timer" onclick="stepStartTimer()"
                                    aria-label="Iniciar temporizador de dibujo"
                                    class="flex-1 bg-emerald-600 py-3 rounded-xl font-black text-sm animate-bounce">¬°INICIAR
                                    TIEMPO!</button>
                            </div>
                        </div>

                        <div id="timer-active-area" class="hidden text-center">
                            <div id="timer-text"
                                class="text-7xl font-mono font-black mb-8 tabular-nums tracking-tighter text-white">
                                01:00</div>
                            <div id="normal-actions" class="flex gap-4">
                                <button onclick="resolveTurn(false)"
                                    class="flex-1 bg-red-600/20 border-2 border-red-600 text-red-500 py-4 rounded-xl font-black uppercase">Fallo</button>
                                <button onclick="resolveTurn(true)"
                                    class="flex-1 bg-green-600 py-4 text-white rounded-xl font-black uppercase shadow-lg shadow-green-900/40">¬°Adivinada!</button>
                            </div>

                            <div id="allplay-actions" class="hidden space-y-3">
                                <p class="text-[10px] text-slate-400 font-bold uppercase italic">¬øQui√©n adivin√≥ primero?
                                </p>
                                <div id="winner-selector" class="flex flex-wrap justify-center gap-2"></div>
                            </div>
                        </div>
                    </div>
                </div> <!-- panel-inner -->
            </div> <!-- controls-panel -->
        </div> <!-- game-main -->
    </div> <!-- game-screen -->
    <audio id="victory-audio"></audio>
    <audio id="defeat-audio"></audio>
    <audio id="tick-audio"></audio>

    <!-- WORD LIST JSON -->
    <script id="words-json" type="application/json">
        {
            "AMARILLO":["Messi","Picasso","Miguel de Cervantes","Shakira","Frida Kahlo","Beyonc√©","Messalina","Atenas","Roma","Madrid","Barcelona","Londres","Par√≠s","Tokio","Nueva York","Buenos Aires","S√≠dney","El Cairo","Mosc√∫","Lima","Cuzco","Quito","Lisboa","Santiago","Bogot√°","Caracas","Montevideo","La Habana","Helsinki","Oslo","Berl√≠n","Viena","Praga","Varsovia","Estocolmo","Dubl√≠n","Dakar","Casablanca","Jerusal√©n","Mumbai","Shangh√°i","Cant√≥n","Hong Kong","Se√∫l","Bangkok","Singapur","Los √Ångeles","Chicago","Toronto","Vancouver","Amazonas","Andes","Sahara","Atl√°ntico","Pac√≠fico","Everest","Kilimanjaro","Mont Blanc","√çbex","Canguro","Puma","Jaguar","Le√≥n","Tigre","Elefante","Rinoceronte","Hipop√≥tamo","Gorila","Chimpanc√©","Orangut√°n","Delf√≠n","Ballena","Tibur√≥n","Foca","Ping√ºino","√Åguila","B√∫ho","Halc√≥n","Lobo","Zorro","Ciervo","Jabal√≠","Erizo","Zarig√ºeya","Cisne","Ganso","Pato","Gallo","Gallina","Pavo","Perro","Gato","Conejo","H√°mster","Llama","Alpaca","Oveja","Cabra","Vaca","Toro","Caballo","Mula","Burro","Camello","Dromedario","√ëu","Ant√≠lope","Mono ara√±a","Perezoso","Tuc√°n","Colibr√≠","Mariposa","Lib√©lula","Escarabajo","Hormiga","Abeja","Ara√±a","Ciempi√©s","Serpiente","Cocodrilo","Tortuga","Lagarto","Camale√≥n","Salamandra","Rana","Sapo","Trucha","Salm√≥n","At√∫n","Sardina","Camar√≥n","Langosta","Pulpo","Calamar","Guepardo","Hiena","Nutria","Tej√≥n","Mapache","Mofeta","Leonardo","Dal√≠","Goya","Vel√°zquez","Sorolla","Greta","Einstein","Newton","Galileo","Curie","Col√≥n","Bol√≠var","San Mart√≠n","Sim√≥n","Isabel","Catalina","Carlos","Felipe","Juana","Alfonso","Federico","Sof√≠a","Mahatma Gandhi","Nelson Mandela","Martin Luther King","Rosa Parks","Cervantes","Lope de Vega","Garcilaso","Borges","Gabriel Garc√≠a M√°rquez","Mario Vargas Llosa","Pablo Neruda","Federico Garc√≠a Lorca","Santos","Carmen","Dolores","Mar√≠a","Jos√©","Antonio","Luis","Miguel","Diego","Rafael","√ìscar","Adriana","Valpara√≠so","Toledo","Segovia","Granada","Sevilla","Salamanca","Zurich","Basilea","Brujas","Amberes"],
            "AZUL":["Tel√©fono","Ordenador","Port√°til","Rat√≥n","Teclado","Pantalla","Monitor","Impresora","Auriculares","Altavoz","C√°mara","Micr√≥fono","Televisor","Mando","Router","Modem","Cargador","Bater√≠a","Conector","Cable","Pendrive","Disco duro","Tarjeta","Libro","Revista","Peri√≥dico","Cuaderno","L√°piz","Bol√≠grafo","Marcador","Rotulador","Goma","Sacapuntas","Regla","Calculadora","Agenda","Carpeta","Archivador","Mesa","Silla","Sof√°","Cama","Colch√≥n","Pillow","Almohada","Armario","Estanter√≠a","L√°mpara","Foco","Bombilla","Ventana","Puerta","Cortina","Persiana","Espejo","Reloj","Calendario","Term√≥metro","Jarr√≥n","Plato","Vaso","Taza","Cuchillo","Tenedor","Cuchara","Olla","Sart√©n","Cacerola","Horno","Microondas","Frigor√≠fico","Nevera","Lavadora","Secadora","Lavavajillas","Aspiradora","Plancha","Tabla de planchar","Timbre","Candado","Llave","Monedero","Cartera","Maleta","Bolso","Mochila","Sombrero","Gorra","Bufanda","Guantes","Zapato","Bota","Sandalia","Calcet√≠n","Cintur√≥n","Corbata","Camisa","Pantal√≥n","Falda","Vestido","Chaqueta","Abrigo","Traje","Ba√±ador","Toalla","Cepillo","Peine","Cepillo de dientes","Pasta dental","Hilo dental","Jab√≥n","Champ√∫","Acondicionador","Desodorante","Crema","Perfume","Maquillaje","Esmalte","Cepillo de pelo","Secador","Cuchilla","Tijeras","Pinzas","Clavo","Martillo","Destornillador","Taladro","Sierra","Lima","Cinta m√©trica","Nivel","Escalera","Silla de ruedas","Bast√≥n","Muletas","Botiqu√≠n","Termo","Botella","Cantimplora","Tarro","Tetera","Cafetera","Molino","Exprimidor","Licuadora","Batidora","Colador","Tabla de cortar","Tupper","Pl√°stico film","Aluminio","Papel","Cart√≥n","Bol√≠grafo t√°ctil","Pantalla t√°ctil","Adaptador","Convertidor","Joystick","Consola","Cartucho","Juego de mesa","Fichas","Tablero","Dados","Carta","Baraja","Puzzle","Rompecabezas","Juguete","Mu√±eco","Robot","Dron","Bicicleta","Patinete","Coche de juguete","Coche","Moto","Cami√≥n","Autob√∫s","Tren","Avi√≥n","Helic√≥ptero","Barco","Bote","Remo","Ancla","Br√∫jula","Mapa","Linterna","Bater√≠a externa","C√°mara t√©rmica","Telescopio","Microscopio","Lupa","Termostato","Sensor","Interruptor","Enchufe","Regleta","Filtro"],
            "NARANJA":["Correr","Saltar","Bailar","Cantar","Nadar","Leer","Escribir","Dibujar","Pintar","Cocinar","Hornear","Fre√≠r","Asar","Sopletear","Montar","Conducir","Pilotar","Navegar","Remar","Lanzar","Atrapar","Golpear","Patear","Empujar","Tirar","Arrastrar","Levantar","Bajar","Abrir","Cerrar","Encender","Apagar","Cortar","Pegar","Coser","Tejer","Hilar","Cosquillear","Abrazar","Besar","Susurrar","Gritar","Whisper (susurrar)","Respirar","Soplar","Aspirar","Limpiar","Fregar","Barrer","Trapear","Enviar","Recibir","Comer","Masticar","Degustar","Beber","Sorber","Escuchar","O√≠r","Ver","Mirar","Observar","Examinar","Analizar","Resolver","Imaginar","So√±ar","Planear","Organizar","Ordenar","Construir","Destruir","Reparar","Arreglar","Instalar","Desinstalar","Actualizar","Programar","Codificar","Depurar","Traducir","Aprender","Ense√±ar","Entrenar","Practicar","Meditar","Relajarse","Dormir","Despertar","Vestir","Desvestir","Peinar","Maquillar","Afeitar","Duchar","Ba√±ar","Cepillar","Cuidar","Atender","Sanar","Curar","Operar","Diagnosticar","Investigar","Explorar","Viajar","Descubrir","Buscar","Encontrar","Perseguir","Escapar","Ocultar","Mostrar","Presentar","Amar","Participar","Competir","Ganar","Perder","Celebrar","Llorar","Re√≠r","Sonre√≠r","Enfadar","Negociar","Comprar","Vender","Pagar","Cobrar","Ahorrar","Invertir","Prestar","Pedir prestado","Reservar","Cancelar","Confirmar","Fotografiar","Grabar","Editar","Subir","Descargar","Compartir","Imprimir","Copiar","Pegar (digital)","Seleccionar","Arrastrar y soltar","Cerrar sesi√≥n","Iniciar sesi√≥n","Registrarse","Publicar","Comentar","Valorar","Suscribirse","Desuscribirse","Enviar mensaje","Recibir llamada","Contestar","Colgar","Silenciar","Activar","Desactivar","Conectar","Desconectar","Sincronizar","Configurar","Personalizar","Dise√±ar","Probar","Evaluar","Optimizar","Reducir","Aumentar","Expandir","Contraer","Mezclar","Separar","Pulir","Lijar","Barnizar","Cantar en coro","Improvisar","Actuar","Direcci√≥n (dirigir)","Coreografiar","Ensayar","Estrenar","Programar evento","Reservar asiento","Comprar entrada","Cerrar trato","Firmar","Sellar","Presentar oferta","Negociar precio","Reparar mec√°nica","Afinar instrumento","Ajustar"],
            "VERDE":["aurora","laberinto","espejismo","sinfon√≠a","dilema","metamorfosis","eco","oasis","crep√∫sculo","amanecer","atardecer","marea","corriente","remolino","catarata","cascada","gruta","penumbra","sombra","reflejo","destello","prisma","mosaico","cometa","eclipse","constelaci√≥n","√≥rbita","im√°n","engranaje","reloj de arena","farol","faro","car√°mbano","volc√°n","geoda","oc√©ano","archipi√©lago","duna","acantilado","laguna","estuario","delta","glaciar","caverna","pen√≠nsula","bah√≠a","cordillera","meseta","llanura","valle","ca√±√≥n","garganta","manantial","fuente","remanso","estanque","banco de niebla","bruma","neblina","tormenta","rel√°mpago","rayo","trueno","tornado","cicl√≥n","hurac√°n","granizo","lluvia","chaparr√≥n","llovizna","arco√≠ris","charco","nevada","avalancha","iceberg","penacho","escarpado","rocalla","pradera","pastizal","matorral","sotobosque","bosquecillo","bosque","selva","jungla","senda","sendero","traves√≠a","molino","barranco","solar","b√∫nker","fortaleza","castillo","torre","muralla","ciudadela","plaza","atalaya","farall√≥n","islote","arrecife","coral","estalactita","estalagmita","cueva","sima","pozo","oquedad","v√≥rtice","turbina","mirador","acueducto","viaducto","canal","esclusa","muelle","embarcadero","fondeadero","astillero","astrolabio","sextante","telescopio","observatorio","mapa","cartograf√≠a","topograf√≠a","pergamino","c√≥dice","vitral","ermita","capilla","monolito","obelisco","menhir","d√≥lmen","cripta","reliquia","sarc√≥fago","catacumba","catapulta","baluarte","basti√≥n","almena","torre√≥n","puente levadizo","atarazana","fragata","carabela","bergant√≠n","gale√≥n","nao","tim√≥n","quilla","cubierta","bodega","camarote","casco","ancla","cadena","estribor","babor","popa","proa","toldo","jarcia","cabo","soga","amarre","fondeo","boya","transatl√°ntico","catamar√°n","velero","yate","chalupa","remo","h√©lice","motor","propulsor","radar","sonar","gabarr√≥n","pont√≥n","rampa","d√°rsena","atracadero","aparejo","deriva","estiba","bit√°cora","cuaderna","miraje","panor√°mica","perspectiva","silencio visual","contraluz","silueta","refugio","mirador natural","saliente","oasis urbano","paraje","mirador costero","terraza natural","is√≥bata","bordillo","morro","abra"],
            "ROJO":["Internet","F√∫tbol","Avi√≥n","Chocolate","Escuela","Navidad","Vacaciones","Guerra","Dinero","Fiesta","Cumplea√±os","Boda","Concierto","Pel√≠cula","Teatro","Festival","Carnaval","Marat√≥n","Carrera","Parque","Piscina","Playa","Monta√±a","Bosque","R√≠o","Lago","Isla","Ciudad","Aldea","Barrio","Mercado","Supermercado","Restaurante","Cafeter√≠a","Panader√≠a","Pasteler√≠a","Helader√≠a","Museo","Galer√≠a","Biblioteca","Estadio","Cancha","Gimnasio","Polideportivo","Pista","Aeropuerto","Estaci√≥n","Puerto","Embarcadero","Terminal","Hospital","Cl√≠nica","Farmacia","Consultorio","Laboratorio","Universidad","Colegio","Escuela infantil","Guarder√≠a","Oficina","Banco","Cajero","Oficina postal","Correos","Tel√©fono p√∫blico","Taller","F√°brica","Almac√©n","Bodega","Estaci√≥n de servicio","Gasolinera","Carretera","Autopista","Puente","T√∫nel","Faro","Farola","Sem√°foro","Rotonda","Cruce","Intersecci√≥n","Avenida","Calle","Camino","Sendero","Vereda","Acera","Plaza","Monumento","Estatua","Fuente","Jard√≠n","Huerto","Invernadero","Parque infantil","Zona deportiva","Pista de hielo","Pista de skate","Patio","Terraza","Balcon","Ventanilla","Sala","Comedor","Cocina","Despensa","Bodega (casa)","S√≥tano","√Åtico","Garaje","Entrada","Vest√≠bulo","Recepci√≥n","Vestuario","Ba√±o","Lavabo","Ducha","Ba√±era","Inodoro","Papel higi√©nico","Juguete","Mu√±eca","Pelota","Cometa","Patineta","Puzle","Instrumento musical","Guitarra","Piano","Viol√≠n","Saxof√≥n","Trompeta","Bater√≠a","Micr√≥fono","Altavoz","Escenario","Tel√≥n","C√°mara de fotos","C√°mara de v√≠deo","Lente","Objetivo","Tr√≠pode","Libro de recetas","Receta","Lista de la compra","Men√∫","Carta","Factura","Recibo","Billete","Pasaporte","Visado","Identificaci√≥n","Carnet","Tarjeta","Permiso","Licencia","Certificado","Diploma","T√≠tulo","Trofeo","Medalla","Premio","Cup√≥n","Descuento","Oferta","Promoci√≥n","Sorteo","Rifa","Subasta","Contrato","Acuerdo","Pacto","Alianza","Sociedad","Empresa","Start-up","Inversi√≥n","Acci√≥n","Bonos","Dividendo","Inter√©s","Cr√©dito","Hipoteca","Pr√©stamo","Seguro","P√≥liza","Indemnizaci√≥n","Reclamaci√≥n","Garant√≠a","Asistencia","Soporte","Atenci√≥n al cliente","Reclamaciones","Queja","Sugerencia","Encuesta","Opini√≥n","Rese√±a","Valoraci√≥n","Mapa del tesoro","Caza del tesoro","Misterio","Detective","Sospechoso","Prueba","Pista","Alibi","Resoluci√≥n","Final feliz"]
        } 
    </script>
    <script>
        /* ---------------- CONFIG ---------------- */
        const IMAGE_URL = "https://upload.wikimedia.org/wikipedia/commons/3/34/Pictionary_game_logo.png";
        const CAT_CONFIG = { AMARILLO: { color: 'bg-yellow-400', text: 'text-black', label: 'Persona / Lugar / Animal', help: 'Nombres propios, famosos, fauna y geograf√≠a.' }, AZUL: { color: 'bg-blue-500', text: 'text-white', label: 'Objeto', help: 'Cosas visibles, partes del cuerpo, alimentos.' }, NARANJA: { color: 'bg-orange-500', text: 'text-white', label: 'Acci√≥n', help: 'Verbos y actividades.' }, VERDE: { color: 'bg-green-600', text: 'text-white', label: 'Dif√≠cil', help: 'Conceptos abstractos o palabras complejas.' }, ROJO: { color: 'bg-red-600', text: 'text-white', label: 'Todos Juegan', help: '¬°Todos los equipos dibujan a la vez!' } };
        const WORD_LISTS = JSON.parse(document.getElementById('words-json').textContent);
        const BOARD_MAP = ['ROJO', 'AMARILLO', 'AZUL', 'NARANJA', 'VERDE', null, 'ROJO', 'AMARILLO', 'AZUL', 'NARANJA', 'VERDE', 'VERDE', null, null, null, 'ROJO', null, 'VERDE', null, null, null, 'ROJO', 'NARANJA', null, null, null, 'AMARILLO', 'AZUL', 'NARANJA', null, null, null, 'AMARILLO', 'AZUL', null, null, null, null, null, null, null, null, null, 'AZUL', 'AMARILLO', 'ROJO', 'VERDE', null, null, null, null, null, 'ROJO', 'VERDE', 'NARANJA', null, null, 'NARANJA', null, null, null, null, null, null, null, null, 'ROJO', 'AMARILLO', 'AZUL', null, null, null, null, null, 'AMARILLO', 'AZUL', 'NARANJA', 'VERDE', null, null, null, null, null, null, null, null, null, 'VERDE', 'NARANJA', null, null, null, 'ROJO', 'VERDE', 'NARANJA', null, null, null, 'ROJO', 'AZUL', null, null, null, 'AMARILLO', null, 'AZUL', null, null, null, 'AMARILLO', 'AMARILLO', 'ROJO', 'VERDE', 'NARANJA', 'AZUL', null, 'AMARILLO', 'ROJO', 'VERDE', 'NARANJA', 'AZUL'];
        const PATH = [74, 75, 76, 87, 98, 109, 120, 119, 118, 117, 116, 105, 94, 93, 92, 103, 114, 113, 112, 111, 110, 99, 88, 77, 66, 67, 68, 57, 46, 45, 44, 33, 22, 11, 0, 1, 2, 3, 4, 15, 26, 27, 28, 17, 6, 7, 8, 9, 10, 21, 32, 43, 54, 53, 52];
        const START_POS = 74;
        const FINAL_POS = 52;
        const PATH_INDEX = Object.fromEntries(PATH.map((p, i) => [p, i]));
        let g = { teams: [], turn: 0, mustRoll: false, timerInterval: null, isAllPlay: false, changeLeft: 3, prevTurn: null, currentWord: null };
        let audioCtx = null;
        let soundEnabled = true;
        let isLight = false;
        let tvMode = false;
        function ensureAudioCtx() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        function toggleTheme() {
            isLight = !isLight;
            document.body.classList.toggle('light-mode', isLight);
            document.getElementById('theme-toggle').innerText =
                isLight ? '‚òÄÔ∏è' : 'üåô';
        }
        function toggleTVMode() {
            tvMode = !tvMode;
            document.body.classList.toggle('tv-mode', tvMode);
            document.getElementById('tv-toggle').innerText =
                tvMode ? '‚ùå' : 'üì∫';

            // Recalcular tablero e imagen central
            setTimeout(() => {
                updateBoardScale();
                placeCenterImage();
            }, 50);
        }
        function playTone(freq, d = 200, type = 'sine', when = 0) {
            if (!soundEnabled) return;
            try {
                ensureAudioCtx();
                const o = audioCtx.createOscillator();
                const gNode = audioCtx.createGain();
                o.type = type;
                o.frequency.value = freq;
                o.connect(gNode);
                gNode.connect(audioCtx.destination);
                const now = audioCtx.currentTime + when;
                gNode.gain.setValueAtTime(0.0001, now);
                gNode.gain.exponentialRampToValueAtTime(0.2, now + 0.01);
                o.start(now);
                gNode.gain.exponentialRampToValueAtTime(0.0001, now + d / 1000);
                o.stop(now + d / 1000 + 0.02);
            } catch (e) {
                console.warn('audio error', e);
            }
        } function playTick() {
            playTone(900, 120, 'square');
        } function playDefeat() {
            playTone(220, 400, 'sine');
        } function playVictory() {
            playTone(880, 200, 'sine');
            setTimeout(() => playTone(1100, 200, 'sine'), 220);
        }
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-toggle').innerText =
                soundEnabled ? 'üîä' : 'üîá';
        }
        let rollInterval = null, rollTimeout = null, rollAnimationTimeout = null;
        /* --- Escalado tablero (se ajusta al ancho del board-wrap) --- */
        function updateBoardScale() {
            const wrap = document.getElementById('board-wrap');
            const board = document.getElementById('board');
            if (!wrap || !board) return;

            // ancho real disponible
            const availableWidth = wrap.clientWidth - 16;

            // ancho natural del tablero (11 columnas)
            const tileSize = parseFloat(
                getComputedStyle(document.documentElement)
                    .getPropertyValue('--tile-size')
            );
            const gap = parseFloat(
                getComputedStyle(document.documentElement)
                    .getPropertyValue('--tile-gap')
            );

            const naturalWidth = (tileSize * 11) + (gap * 10);

            // escala segura
            const scale = Math.min(1, availableWidth / naturalWidth);

            board.style.transform = `scale(${scale})`;
            board.style.transformOrigin = 'top center';

            // evita desbordes visuales
            wrap.style.overflowX = 'hidden';

            // ajusta altura del contenedor
            const naturalHeight = board.scrollHeight;
            if (window.innerWidth < 900) {
                wrap.style.height = `${Math.ceil(naturalHeight * scale)}px`;
            } else {
                wrap.style.height = 'auto';
            }

            setTimeout(placeCenterImage, 30);
        }
        function renderBoard() {
            const b = document.getElementById('board');
            [...b.querySelectorAll('[id^="tile-"]')].forEach(el => el.remove());
            for (let i = 0; i < BOARD_MAP.length; i++) {
                const catKey = BOARD_MAP[i];
                const tile = document.createElement('div');
                tile.id = `tile-${i}`;
                tile.className = `w-full h-full rounded-lg flex items-center justify-center text-sm relative overflow-hidden z-10`;
                if (catKey === null) {
                    tile.classList.add('bg-transparent', 'border', 'border-transparent');
                    tile.innerHTML = `<div id="tks-${i}" class="absolute inset-0 flex items-center justify-center gap-1 p-1"></div>`;
                } else {
                    const cfg = CAT_CONFIG[catKey];
                    const inicial = catKey.charAt(0).toUpperCase();
                    tile.classList.add(cfg.color, cfg.text, 'font-black', 'shadow-inner');
                    tile.innerHTML = `<span class="text-sm">${inicial}</span><div id="tks-${i}" class="absolute inset-0 flex items-center justify-center gap-1 p-1"></div>`;
                } b.appendChild(tile);
            } setTimeout(updateBoardScale, 20);
        } function placeCenterImage() {
            const wrapElem = document.getElementById('board-wrap');
            const firstTile = document.getElementById('tile-48');
            const lastTile = document.getElementById('tile-72');
            const imgWrap = document.getElementById('center-img-wrap');
            if (!firstTile || !lastTile || !wrapElem || !imgWrap) {
                setTimeout(placeCenterImage, 50);
                return;
            } const wrapRect = wrapElem.getBoundingClientRect();
            const firstRect = firstTile.getBoundingClientRect();
            const lastRect = lastTile.getBoundingClientRect();
            const left = firstRect.left - wrapRect.left + wrapElem.scrollLeft;
            const top = firstRect.top - wrapRect.top + wrapElem.scrollTop;
            const right = lastRect.right - wrapRect.left + wrapElem.scrollLeft;
            const bottom = lastRect.bottom - wrapRect.top + wrapElem.scrollTop;
            const width = Math.max(0, right - left);
            const height = Math.max(0, bottom - top);
            imgWrap.style.left = `${left}px`;
            imgWrap.style.top = `${top}px`;
            imgWrap.style.width = `${width}px`;
            imgWrap.style.height = `${height}px`;
            imgWrap.style.display = 'flex';
            imgWrap.style.alignItems = 'center';
            imgWrap.style.justifyContent = 'center';
            imgWrap.style.overflow = 'hidden';
            const existing = document.getElementById('center-img');
            if (existing) existing.src = IMAGE_URL;
            else imgWrap.innerHTML = `<img id="center-img" src="${IMAGE_URL}" alt="center" style="object-fit:contain;width:100%;height:100%;max-width:100%;max-height:100%;opacity:0.98;pointer-events:none;">`;
        } window.addEventListener('resize', () => {
            setTimeout(() => {
                updateBoardScale();
            }, 40);
        });
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateBoardScale();
            }, 120);
        });
        document.addEventListener('DOMContentLoaded', () => {
            const wrap = document.getElementById('board-wrap');
            if (wrap) wrap.addEventListener('scroll', () => placeCenterImage());
            setTimeout(() => placeCenterImage(), 120);
        });
        /* ---------------- Helpers y l√≥gica del juego (igual que antes) ---------------- */
        function addTeamField() {
            const container = document.getElementById('teams-container');
            if (container.children.length >= 4) return;
            const input = document.createElement('input');
            input.className = "team-in w-full p-4 rounded-xl bg-slate-700 border-none focus:ring-2 ring-yellow-500";
            input.value = `Equipo ${container.children.length + 1}`;
            container.appendChild(input);
        }
        function initGame() {
            const inputs = document.querySelectorAll('.team-in');
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b'];
            g.teams = Array.from(inputs).map((inp, i) => ({ name: inp.value || `Equipo ${i + 1}`, pos: START_POS, color: colors[i] || '#9CA3AF' }));
            g.turn = 0;
            g.mustRoll = false;
            g.isAllPlay = false;
            g.changeLeft = 3;
            g.prevTurn = g.turn;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            renderBoard();
            setTimeout(() => {
                placeCenterImage();
                updateUI();
            }, 120);
            try {
                if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
            } catch (e) { }
        }
        function updateUI() {
            const header = document.querySelector('.game-header');
            header.classList.remove('header-turn-indicator');
            void header.offsetWidth;
            header.classList.add('header-turn-indicator');
            const team = g.teams[g.turn];
            if (g.prevTurn !== g.turn) {
                g.changeLeft = 3;
                document.getElementById('change-left').innerText = g.changeLeft;
                g.prevTurn = g.turn;
            } const catKey = getCatAt(team.pos);
            const cfg = (catKey && CAT_CONFIG[catKey]) ? CAT_CONFIG[catKey] : null;
            const nameDisp = document.getElementById('current-team-name');
            nameDisp.classList.remove('turn-animate');
            void nameDisp.offsetWidth; // force reflow
            nameDisp.innerText = team.name;
            nameDisp.style.color = team.color;
            nameDisp.classList.add('turn-animate');
            const pill = document.getElementById('cat-pill');
            if (cfg) {
                pill.innerText = cfg.label;
                pill.className = `px-6 py-1.5 rounded-full text-[10px] font-black tracking-widest border-2 border-white/20 mb-2 ${cfg.color} ${cfg.text}`;
                document.getElementById('cat-instruction').innerText = cfg.help;
                document.getElementById('btn-see-card').disabled = false;
                document.getElementById('btn-see-card').classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                pill.innerText = 'VAC√çO';
                pill.className = `px-6 py-1.5 rounded-full text-[10px] font-black tracking-widest border-2 border-white/20 mb-2 bg-slate-700 text-white`;
                document.getElementById('cat-instruction').innerText = 'Casilla vac√≠a.';
                document.getElementById('btn-see-card').disabled = true;
                document.getElementById('btn-see-card').classList.add('opacity-50', 'cursor-not-allowed');
            } document.getElementById('ui-move').classList.toggle('hidden', !g.mustRoll);
            document.getElementById('ui-draw').classList.toggle('hidden', g.mustRoll);
            resetPhases();
            drawTokens();
            highlightActiveTile();
        }
        function resetPhases() {
            document.getElementById('btn-see-card').classList.remove('hidden');
            document.getElementById('word-reveal-area').classList.add('hidden');
            document.getElementById('timer-active-area').classList.add('hidden');
            clearInterval(g.timerInterval);
            g.currentWord = null;
        }

        let lastPositions = [];

        function drawTokens() {
            const positions = g.teams.map(t => t.pos);
            if (JSON.stringify(positions) === JSON.stringify(lastPositions)) return;
            lastPositions = [...positions];


            document.querySelectorAll('[id^="tks-"]').forEach(el => el.innerHTML = '');


            const counts = {};
            g.teams.forEach(t => counts[t.pos] = (counts[t.pos] || 0) + 1);


            g.teams.forEach((t, i) => {
                const c = document.getElementById(`tks-${t.pos}`);
                if (!c) return;


                c.className = counts[t.pos] >= 3
                    ? 'absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1 items-center justify-items-center z-20'
                    : 'absolute inset-0 flex items-center justify-center gap-1 p-1 z-20';


                const dot = document.createElement('div');
                dot.className = `token ${i === g.turn ? 'active' : ''}`;
                dot.style.backgroundColor = t.color;
                c.appendChild(dot);
            });
        }
        function getCatAt(pos) {
            if (pos == null || pos < 0 || pos >= BOARD_MAP.length) return null;
            return BOARD_MAP[pos];
        }
        function pathIndexOf(pos) {
            return PATH_INDEX[pos] ?? 0;
        }
        function moveTeamAnimated(team, steps, callback) {
            let idx = pathIndexOf(team.pos);
            let target = Math.min(idx + steps, PATH.length - 1);

            function step() {
                if (idx >= target) {
                    if (callback) callback();
                    return;
                }
                idx++;
                team.pos = PATH[idx];
                drawTokens();
                highlightActiveTile();
                setTimeout(step, 220);
            }
            step();
        }
        function changeWord() {
            if (g.changeLeft <= 0) return;
            const team = g.teams[g.turn];
            const cat = getCatAt(team.pos);
            if (!cat) return;
            const pool = WORD_LISTS[cat];
            if (!pool || pool.length === 0) return;
            let newWord = pool[Math.floor(Math.random() * pool.length)];
            let attempts = 0;
            while (newWord === g.currentWord && attempts < 10) {
                newWord = pool[Math.floor(Math.random() * pool.length)];
                attempts++;
            } g.currentWord = newWord;
            document.getElementById('target-word').innerText = newWord;
            g.changeLeft--;
            document.getElementById('change-left').innerText = g.changeLeft;
            if (g.changeLeft <= 0) {
                document.getElementById('btn-change-word').disabled = true;
                document.getElementById('btn-change-word').classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        function rollDice() {
            const finalRoll = Math.floor(Math.random() * 6) + 1;
            const faces = ["", "‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];
            const faceSpan = document.getElementById('dice-face');
            const diceBtn = document.getElementById('dice-btn');
            if (diceBtn) diceBtn.disabled = true;
            if (diceBtn) diceBtn.classList.add('dice-rolling');
            const spinChars = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];
            let idx = 0;
            if (rollInterval) clearInterval(rollInterval);
            rollInterval = setInterval(() => {
                faceSpan.innerText = spinChars[idx % spinChars.length];
                idx++;
            }, 80);
            const SPIN_MS = 900;
            rollAnimationTimeout = setTimeout(() => {
                if (rollInterval) {
                    clearInterval(rollInterval);
                    rollInterval = null;
                } if (diceBtn) diceBtn.classList.remove('dice-rolling');
                faceSpan.innerText = (faces[finalRoll] && faces[finalRoll].trim() !== "") ? faces[finalRoll] : `${finalRoll}`;
                faceSpan.classList.add('dice-face-final');
                const SHOW_MS = 2800;
                rollTimeout = setTimeout(() => {
                    faceSpan.classList.remove('dice-face-final');
                    const team = g.teams[g.turn];
                    let curIdx = pathIndexOf(team.pos);
                    if (curIdx === -1) curIdx = 0;
                    let newIdx = curIdx + finalRoll;
                    if (newIdx >= PATH.length) newIdx = PATH.length - 1;
                    /*team.pos = PATH[newIdx];
                    g.mustRoll = false;
                    updateUI();*/
                    const steps = finalRoll;
                    moveTeamAnimated(team, steps, () => {
                        g.mustRoll = false;
                        updateUI();
                    });
                    if (diceBtn) diceBtn.disabled = false;
                    rollTimeout = null;
                }, SHOW_MS);
                rollAnimationTimeout = null;
            }, SPIN_MS);
        } function stepRevealWord() {
            const cat = getCatAt(g.teams[g.turn].pos);
            if (!cat) return;
            const pool = WORD_LISTS[cat];
            if (!pool || pool.length === 0) return;
            g.currentWord = pool[Math.floor(Math.random() * pool.length)];
            document.getElementById('target-word').innerText = g.currentWord;
            document.getElementById('btn-see-card').classList.add('hidden');
            document.getElementById('word-reveal-area').classList.remove('hidden');
            document.getElementById('status-badge').innerText = "FASE: PENSANDO...";
            g.isAllPlay = (cat === 'ROJO');
            if (g.changeLeft == null) g.changeLeft = 3;
            document.getElementById('change-left').innerText = g.changeLeft;
            const changeBtn = document.getElementById('btn-change-word');
            if (g.changeLeft > 0) {
                changeBtn.disabled = false;
                changeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                changeBtn.disabled = true;
                changeBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        } function stepStartTimer() {
            document.getElementById('word-reveal-area').classList.add('hidden');
            document.getElementById('timer-active-area').classList.remove('hidden');
            document.getElementById('status-badge').innerText = "FASE: ¬°DIBUJA YA!";
            if (g.isAllPlay) {
                document.getElementById('normal-actions').classList.add('hidden');
                document.getElementById('allplay-actions').classList.remove('hidden');
                setupAllPlayButtons();
            } else {
                document.getElementById('normal-actions').classList.remove('hidden');
                document.getElementById('allplay-actions').classList.add('hidden');
            } let segs = 60;
            const tText = document.getElementById('timer-text');
            tText.classList.remove('timer-low');
            tText.innerText = '01:00';
            clearInterval(g.timerInterval);
            g.timerInterval = setInterval(() => {
                segs--;
                tText.innerText = `00:${segs.toString().padStart(2, '0')}`;
                if (segs <= 10) tText.classList.add('timer-low');
                if (segs > 0 && segs <= 5) playTick();
                if (segs <= 0) {
                    clearInterval(g.timerInterval);
                    playDefeat();
                }
            }, 1000);
        } function setupAllPlayButtons() {
            const container = document.getElementById('winner-selector');
            container.innerHTML = '';
            g.teams.forEach((t, i) => {
                const btn = document.createElement('button');
                btn.className = "px-4 py-3 rounded-xl font-black text-[10px] text-white uppercase shadow-md";
                btn.style.backgroundColor = t.color;
                btn.innerText = t.name;
                btn.onclick = () => resolveTurn(true, i);
                container.appendChild(btn);
            });
            const none = document.createElement('button');
            none.className = "px-4 py-3 rounded-xl font-black text-[10px] bg-slate-600 text-white uppercase";
            none.innerText = "NADIE";
            none.onclick = () => resolveTurn(false);
            container.appendChild(none);
        } function resolveTurn(success, winnerIdx = null) {
            clearInterval(g.timerInterval);
            if (g.isAllPlay) {
                if (winnerIdx !== null) {
                    const winner = g.teams[winnerIdx];
                    if (winner.pos === FINAL_POS) {
                        playVictory();
                        setTimeout(() => {
                            alert(`üèÜ ¬°GANADOR: ${winner.name.toUpperCase()}!`);
                            location.reload();
                        }, 300);
                        return;
                    } g.turn = winnerIdx;
                    g.mustRoll = true;
                    g.changeLeft = 3;
                } else {
                    g.turn = (g.turn + 1) % g.teams.length;
                    g.mustRoll = false;
                    g.changeLeft = 3;
                }
            } else {
                if (success) {
                    g.mustRoll = true;
                } else {
                    g.turn = (g.turn + 1) % g.teams.length;
                    g.mustRoll = false;
                    g.changeLeft = 3;
                }
            } updateUI();
        }
        function highlightActiveTile() {
            document.querySelectorAll('[id^="tile-"]').forEach(el =>
                el.classList.remove('tile-active')
            );
            const tile = document.getElementById(`tile-${g.teams[g.turn].pos}`);
            if (tile) tile.classList.add('tile-active');
        }
        function confirmReset() {
            if (confirm('¬øSeguro que quieres reiniciar la partida? Se perder√° el progreso actual.')) resetGame();
        }
        function resetGame() {
            clearInterval(g.timerInterval);
            g.timerInterval = null;
            if (rollInterval) {
                clearInterval(rollInterval);
                rollInterval = null;
            } if (rollTimeout) {
                clearTimeout(rollTimeout);
                rollTimeout = null;
            } if (rollAnimationTimeout) {
                clearTimeout(rollAnimationTimeout);
                rollAnimationTimeout = null;
            } g.teams = [];
            g.turn = 0;
            g.mustRoll = false;
            g.isAllPlay = false;
            g.changeLeft = 3;
            g.prevTurn = null;
            g.currentWord = null;
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('setup-screen').classList.remove('hidden');
            const container = document.getElementById('teams-container');
            container.innerHTML = '';
            const inp1 = document.createElement('input');
            inp1.className = "team-in w-full p-4 rounded-xl bg-slate-700 border-none focus:ring-2 ring-yellow-500";
            inp1.value = "Equipo 1";
            const inp2 = document.createElement('input');
            inp2.className = inp1.className;
            inp2.value = "Equipo 2";
            container.appendChild(inp1);
            container.appendChild(inp2);
            const b = document.getElementById('board');
            [...b.querySelectorAll('[id^="tile-"]')].forEach(el => el.remove());
            const faceSpan = document.getElementById('dice-face');
            if (faceSpan) {
                faceSpan.classList.remove('dice-face-final');
                faceSpan.classList.remove('dice-rolling');
                faceSpan.innerText = 'üé≤';
            } document.getElementById('current-team-name').innerText = '---';
            document.getElementById('cat-pill').innerText = '---';
            document.getElementById('cat-instruction').innerText = '---';
            document.getElementById('status-badge').innerText = 'FASE: PREPARACI√ìN';
            try {
                if (audioCtx && audioCtx.state !== 'closed') {
                    audioCtx.close();
                    audioCtx = null;
                }
            } catch (e) { } const wrap = document.getElementById('center-img-wrap');
            if (wrap) wrap.innerHTML = '';
        }  
    </script>
</body>

</html>
